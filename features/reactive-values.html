<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang=""><head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <title>Quarto Observable – Reactive Values</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>

  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
  <script src="../site_libs/quarto-nav/quarto-nav.js"></script>
  <script src="../site_libs/quarto-nav/headroom.min.js"></script>
  <meta name="quarto:offset" content="../">
  <script src="../site_libs/quarto-search/autocomplete.min.js"></script>
  <script src="../site_libs/quarto-search/fuse.min.js"></script>
  <script src="../site_libs/quarto-search/quarto-search.js"></script>
  <script src="../site_libs/quarto-html/quarto.js"></script>
  <script src="../site_libs/quarto-html/popper.min.js"></script>
  <script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
  <script src="../site_libs/quarto-html/clipboard.min.js"></script>
  <script src="../site_libs/quarto-html/anchor.min.js"></script>
  <script src="../site_libs/quarto-html/quarto-html.js"></script>
  <link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
  <link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet">
  <script src="../site_libs/bootstrap/bootstrap.min.js"></script>
  <link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
  <link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet">
  <script type="module" src="../site_libs/quarto-ojs/ojs-bundle.js"></script>
  <link href="../site_libs/quarto-ojs/quarto-ojs.css" rel="stylesheet">
  <link rel="stylesheet" href="../styles.css">
</head>
<body>
<div id="quarto-search-results"></div>
<header id="quarto-header" class="headroom fixed-top">
<nav class="quarto-secondary-nav py-2 d-lg-none d-md-block " data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <div class="container-fluid d-flex justify-content-between">
    <h1 class="quarto-secondary-nav-title mb-0 fs-3 d-inline">Reactive Values</h1>
    <button type="button" class="quarto-btn-toggle btn d-lg-none py-0 px-1 d-inline-block border-0 ">
      <i class="bi bi-chevron-right"></i>
    </button>
  </div>
</nav>
</header>
 <!-- /navbar/sidebar -->
<div class="container-fluid quarto-container d-flex flex-column page-layout-article">
<div class="row flex-fill" id="quarto-content">
  <div id="quarto-sidebar" class="col col-12 col-lg-3 d-lg-flex px-0 pt-0 sidebar collapse sidebar-navigation">
    <nav class="me-lg-auto py-2 docked  overflow-scroll">
  <div class="px-3 pt-lg-2 mt-1 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">
      Quarto Observable
      </a>
    </div>
  </div>
    <div class="d-flex px-3 mt-2 flex-shrink-0 align-items-center">
      <div class="sidebar-search">
      <form class="d-flex mb-0">
  <input id="quarto-search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>
      </div>
    </div>
  <div class="sidebar-menu-container"> 
  <ul class="list-unstyled mt-3 px-3">
      <ul class="list-unstyled sidebar-section depth1">
    <li class="">
        <div class="me-auto ">
            <a class="sidebar-section-item d-inline-flex text-start w-100 " data-bs-toggle="collapse" data-bs-target="#main-collapse" aria-expanded="true">
              <div class="me-auto  sidebar-section-item">Main</div>
            <div><i class="bi bi-chevron-right ms-2 "></i></div>
            </a>
        </div>
      <div class="collapse  show" id="main-collapse">
        <ul class="list-unstyled sidebar-item-contents">
          <li class="sidebar-item">
  <a href="../index.html" class="">Quarto OJS</a>
</li>
          <ul class="list-unstyled sidebar-section depth2">
    <li class="">
        <div class="me-auto ">
            <a class="sidebar-section-item d-inline-flex text-start w-100 " data-bs-toggle="collapse" data-bs-target="#features-collapse" aria-expanded="true">
              <div class="me-auto  sidebar-item">Features</div>
            <div><i class="bi bi-chevron-right ms-2 "></i></div>
            </a>
        </div>
      <div class="collapse  show" id="features-collapse">
        <ul class="list-unstyled sidebar-item-contents">
          <li class="sidebar-item">
  <a href="../features/javascript.html" class="">Quarto + Javascript</a>
</li>
          <li class="sidebar-item">
  <a href="../features/not-javascript.html" class="">Quarto + OJS</a>
</li>
          <li class="sidebar-item">
  <a href="../features/reactive-values.html" class="active">Reactive Values</a>
</li>
          <li class="sidebar-item">
  <a href="../features/file-attachments.html" class="">Files and File Attachments</a>
</li>
          <li class="sidebar-item">
  <a href="../features/observable-modules.html" class="">OJS Modules</a>
</li>
          <ul class="list-unstyled sidebar-section depth3">
    <li class="">
        <div class="me-auto ">
            <a class="sidebar-section-item d-inline-flex text-start w-100 collapsed" data-bs-toggle="collapse" data-bs-target="#es6-collapse" aria-expanded="false">
              <div class="me-auto  sidebar-item">ES6</div>
            <div><i class="bi bi-chevron-right ms-2 "></i></div>
            </a>
        </div>
      <div class="collapse  " id="es6-collapse">
        <ul class="list-unstyled sidebar-item-contents">
          <li class="sidebar-item">
  <a href="../module-tests/es6-module-import.html" class="">ES6 Module Imports</a>
</li>
          <li class="sidebar-item">
  <a href="../module-tests/module-import-2.html" class="">ES6 Recursive Imports</a>
</li>
        </ul>
      </div>
    </li>
  </ul>
        </ul>
      </div>
    </li>
  </ul>
        </ul>
      </div>
    </li>
  </ul>
      <ul class="list-unstyled sidebar-section depth1">
    <li class="">
        <div class="me-auto ">
            <a class="sidebar-section-item d-inline-flex text-start w-100 " data-bs-toggle="collapse" data-bs-target="#tests-collapse" aria-expanded="true">
              <div class="me-auto  sidebar-section-item">Tests</div>
            <div><i class="bi bi-chevron-right ms-2 "></i></div>
            </a>
        </div>
      <div class="collapse  show" id="tests-collapse">
        <ul class="list-unstyled sidebar-item-contents">
          <li class="sidebar-item">
  <a href="../tests/index.html" class="">Quarto Observable Test Index</a>
</li>
        </ul>
      </div>
    </li>
  </ul>
  </ul>
  </div>
</nav>
  </div>
  <div id="quarto-toc-sidebar" class="col col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-toc order-last"><nav id="TOC" role="doc-toc">
<h2 id="toc-title">On this page</h2>
<ul>
<li><a href="#enter-reactive-values" class="nav-link active" data-scroll-target="#enter-reactive-values">Enter reactive values</a></li>
<li><a href="#extras" class="nav-link" data-scroll-target="#extras">Extras</a></li>
</ul>
</nav></div>
  <div class="col mx-auto col-sm-12 col-md-9 col-lg-7 px-lg-4">
<main>
<header id="title-block-header">
<div class="quarto-title-block d-none d-lg-block"><h1 class="title d-none d-lg-block">Reactive Values</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div>
</header>

<p>The fundamental difference between “plain Javascript” and Observable’s version of Javascript (here, “OJS”) is its native support for <em>reactivity</em>.</p>
<p>Imagine you wanted to create a simple visual time display shaped like an analog clock (or, looking ahead, imagine a JS dashboard that periodically updates itself). Whatever you end up showing ultimately will depend on the current time. So you start writing functions which compute the present time:</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="sourceCode js cell-code code-with-copy"><code class="sourceCode javascript"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>currentTime <span class="op">=</span> <span class="kw">function</span>() {</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="bu">Date</span><span class="op">.</span><span class="fu">now</span>()<span class="op">;</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>currentHours <span class="op">=</span> <span class="kw">function</span>() {</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> (<span class="bu">Date</span><span class="op">.</span><span class="fu">now</span>() <span class="op">/</span> (<span class="dv">3600</span> <span class="op">*</span> <span class="dv">1000</span>)) <span class="op">%</span> <span class="dv">12</span><span class="op">;</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>currentMinutes <span class="op">=</span> <span class="kw">function</span>() {</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> (<span class="bu">Date</span><span class="op">.</span><span class="fu">now</span>() <span class="op">/</span> (<span class="dv">60</span> <span class="op">*</span> <span class="dv">1000</span>)) <span class="op">%</span> <span class="dv">60</span><span class="op">;</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>currentSeconds <span class="op">=</span> <span class="kw">function</span>() {</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> (<span class="bu">Date</span><span class="op">.</span><span class="fu">now</span>() <span class="op">/</span> <span class="dv">1000</span>) <span class="op">%</span> <span class="dv">60</span><span class="op">;</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display hidden">
<div>
<div id="ojs-cell-1-1">

</div>
</div>
</div>
<div class="cell-output-display hidden">
<div>
<div id="ojs-cell-1-2">

</div>
</div>
</div>
<div class="cell-output-display hidden">
<div>
<div id="ojs-cell-1-3">

</div>
</div>
</div>
<div class="cell-output-display hidden">
<div>
<div id="ojs-cell-1-4">

</div>
</div>
</div>
</div>
<p>But <code>Date.now()</code> is always changing, and so your plain Javascript code needs infrastructure to update the display constantly, otherwise that value is only computed once per call:</p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="sourceCode js cell-code code-with-copy"><code class="sourceCode javascript"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>staticTime <span class="op">=</span> { </span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> { <span class="dt">hours</span><span class="op">:</span> <span class="fu">currentHours</span>()<span class="op">,</span> <span class="dt">minutes</span><span class="op">:</span> <span class="fu">currentMinutes</span>()<span class="op">,</span> <span class="dt">seconds</span><span class="op">:</span> <span class="fu">currentSeconds</span>() }<span class="op">;</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>htl<span class="op">.</span><span class="fu">html</span><span class="vs">`&lt;tt&gt;</span><span class="sc">${</span><span class="fu">fmt</span>(<span class="fu">currentHours</span>())<span class="sc">}</span><span class="vs">:</span><span class="sc">${</span><span class="fu">fmt</span>(<span class="fu">currentMinutes</span>())<span class="sc">}</span><span class="vs">:</span><span class="sc">${</span><span class="fu">fmt</span>(<span class="fu">currentSeconds</span>())<span class="sc">}</span><span class="vs">&lt;/tt&gt;`</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<div id="ojs-cell-2-1">

</div>
</div>
</div>
<div class="cell-output-display">
<div>
<div id="ojs-cell-2-2">

</div>
</div>
</div>
</div>
<p>“This is fine,” you say. After all, we have Javascript:</p>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="sourceCode js cell-code code-with-copy"><code class="sourceCode javascript"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>ttEl <span class="op">=</span> {</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"tt"</span>)<span class="op">;</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="ojs-cell-3">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="sourceCode js cell-code code-with-copy"><code class="sourceCode javascript"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">updateEl</span>() {</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  ttEl<span class="op">.</span><span class="at">innerText</span> <span class="op">=</span> <span class="vs">`</span><span class="sc">${</span><span class="fu">fmt</span>(<span class="fu">currentHours</span>())<span class="sc">}</span><span class="vs">:</span><span class="sc">${</span><span class="fu">fmt</span>(<span class="fu">currentMinutes</span>())<span class="sc">}</span><span class="vs">:</span><span class="sc">${</span><span class="fu">fmt</span>(<span class="fu">currentSeconds</span>())<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="bu">window</span><span class="op">.</span><span class="fu">requestAnimationFrame</span>(updateEl)<span class="op">;</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="fu">updateEl</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display hidden">
<div>
<div id="ojs-cell-4-1">

</div>
</div>
</div>
<div class="cell-output-display hidden">
<div>
<div id="ojs-cell-4-2">

</div>
</div>
</div>
</div>
<p>But what if your data only updates once a minute? What if you <em>don’t know</em> how often your data updates? Eventually code like this becomes a delicate dance of signals and event handlers. Things can get quickly out of hand.</p>
<section id="enter-reactive-values" class="level2">
<h2 class="anchored" data-anchor-id="enter-reactive-values">Enter reactive values</h2>
<p>OJS, on the other hand, lets you define “reactive” values: special values that can change, <em>and notify downstream code about the change</em>. So, we can write this instead:</p>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="sourceCode js cell-code code-with-copy"><code class="sourceCode javascript"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">// "now" is a predefined reactive value that returns the current</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co">// value of Date.now()</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>reactiveTime <span class="op">=</span> {</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> hours <span class="op">=</span> (now <span class="op">/</span> (<span class="dv">3600</span> <span class="op">*</span> <span class="dv">1000</span>)) <span class="op">%</span> <span class="dv">12</span><span class="op">;</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> minutes <span class="op">=</span> (now <span class="op">/</span> (<span class="dv">60</span> <span class="op">*</span> <span class="dv">1000</span>)) <span class="op">%</span> <span class="dv">60</span><span class="op">;</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> seconds <span class="op">=</span> (now <span class="op">/</span> <span class="dv">1000</span>) <span class="op">%</span> <span class="dv">60</span><span class="op">;</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> { hours<span class="op">,</span> minutes<span class="op">,</span> seconds }<span class="op">;</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="ojs-cell-5">

</div>
</div>
</div>
<p>Now the values automatically update themselves. In OJS, you can write code that uses these as if they were regular Javascript values. OJS notices you’re using reactive values, and turns your definition into a reactive value as well:</p>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="sourceCode js cell-code code-with-copy"><code class="sourceCode javascript"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>timeString <span class="op">=</span> htl<span class="op">.</span><span class="fu">html</span><span class="vs">`&lt;tt&gt;</span><span class="sc">${</span><span class="fu">fmt</span>(reactiveTime<span class="op">.</span><span class="at">hours</span>)<span class="sc">}</span><span class="vs">:</span><span class="sc">${</span><span class="fu">fmt</span>(reactiveTime<span class="op">.</span><span class="at">minutes</span>)<span class="sc">}</span><span class="vs">:</span><span class="sc">${</span><span class="fu">fmt</span>(reactiveTime<span class="op">.</span><span class="at">seconds</span>)<span class="sc">}</span><span class="vs">&lt;/tt&gt;`</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="ojs-cell-6">

</div>
</div>
</div>
<p>But we wanted an analog clock. So let’s make an analog clock, using SVG.</p>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="sourceCode js cell-code code-with-copy"><code class="sourceCode javascript"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>clock <span class="op">=</span> {</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>   <span class="kw">const</span> { hours<span class="op">,</span> minutes<span class="op">,</span> seconds } <span class="op">=</span> reactiveTime<span class="op">;</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>   <span class="kw">const</span> result <span class="op">=</span> <span class="fu">svg</span><span class="vs">`&lt;svg width=200 height=200&gt;&lt;/svg&gt;`</span><span class="op">;</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>   <span class="kw">const</span> hourAngle <span class="op">=</span> <span class="fu">toClockAngle</span>(hours <span class="op">/</span> <span class="dv">12</span>)<span class="op">;</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>   <span class="kw">const</span> minuteAngle <span class="op">=</span> <span class="fu">toClockAngle</span>(minutes <span class="op">/</span> <span class="dv">60</span>)<span class="op">;</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>   <span class="kw">const</span> secondAngle <span class="op">=</span> <span class="fu">toClockAngle</span>(seconds <span class="op">/</span> <span class="dv">60</span>)<span class="op">;</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>   <span class="kw">const</span> main <span class="op">=</span> <span class="fu">svg</span><span class="vs">`&lt;g transform="translate(100, 100) scale(1, -1)"&gt;&lt;/g&gt;`</span><span class="op">;</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>   result<span class="op">.</span><span class="fu">appendChild</span>(main)<span class="op">;</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>   main<span class="op">.</span><span class="fu">appendChild</span>(<span class="fu">svg</span><span class="vs">`&lt;circle r=95 fill="#eee"&gt;&lt;/circle&gt;`</span>)<span class="op">;</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>   main<span class="op">.</span><span class="fu">appendChild</span>(<span class="fu">clockHand</span>(secondAngle<span class="op">,</span> <span class="st">"red"</span><span class="op">,</span> <span class="dv">1</span>))<span class="op">;</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>   main<span class="op">.</span><span class="fu">appendChild</span>(<span class="fu">clockHand</span>(minuteAngle<span class="op">,</span> <span class="st">"black"</span><span class="op">,</span> <span class="dv">1</span>))<span class="op">;</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>   main<span class="op">.</span><span class="fu">appendChild</span>(<span class="fu">clockHand</span>(hourAngle<span class="op">,</span> <span class="st">"black"</span><span class="op">,</span> <span class="dv">3</span>))<span class="op">;</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>   <span class="cf">return</span> result<span class="op">;</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-1" class="cell-output-display quarto-figure quarto-figure-center anchored">
<figure class="figure">
<div id="ojs-cell-7">

</div>
<p></p><figcaption aria-hidden="true" class="figure-caption">Figure 1: An SVG clock built with reactive values.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></figcaption><p></p>
</figure>
</div>
</div>
<p>OJS makes sure your SVG definition is also reactive, since it also uses reactive values.</p>
</section>
<section id="extras" class="level2">
<h2 class="anchored" data-anchor-id="extras">Extras</h2>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="sourceCode js cell-code code-with-copy"><code class="sourceCode javascript"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">fmt</span>(n)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>   <span class="kw">const</span> s <span class="op">=</span> (<span class="st">"00"</span> <span class="op">+</span> <span class="bu">String</span>(<span class="op">~~</span>n))<span class="op">;</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>   <span class="cf">return</span> s<span class="op">.</span><span class="fu">substr</span>(s<span class="op">.</span><span class="at">length</span> <span class="op">-</span> <span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">toClockAngle</span>(v)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">// some math is needed here because unlike polar coordinates, </span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">// clock hands run clockwise and start at the "north pole"</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="op">-</span>(<span class="op">-</span><span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span> <span class="op">/</span> <span class="dv">2</span> <span class="op">+</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span> <span class="op">*</span> <span class="dv">2</span> <span class="op">*</span> v) <span class="op">*</span> (<span class="dv">180</span> <span class="op">/</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span>)<span class="op">;</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">clockHand</span>(angle<span class="op">,</span> color<span class="op">,</span> width)</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">svg</span><span class="vs">`&lt;line transform="rotate(</span><span class="sc">${</span>angle<span class="sc">}</span><span class="vs">)" x1=0 y1=0 x2=90 y2=0 stroke=</span><span class="sc">${</span>color<span class="sc">}</span><span class="vs"> stroke-width=</span><span class="sc">${</span>width<span class="sc">}</span><span class="vs">&gt;&lt;/line&gt;`</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display hidden">
<div>
<div id="ojs-cell-8-1">

</div>
</div>
</div>
<div class="cell-output-display hidden">
<div>
<div id="ojs-cell-8-2">

</div>
</div>
</div>
<div class="cell-output-display hidden">
<div>
<div id="ojs-cell-8-3">

</div>
</div>
</div>
</div>
<!-- -->
<div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title anchored" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb9" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Reactive Values"</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>The fundamental difference between "plain Javascript" and Observable's</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>version of Javascript (here, "OJS") is its native support for</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>_reactivity_.</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>Imagine you wanted to create a simple visual time display shaped like</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>an analog clock (or, looking ahead, imagine a JS dashboard that</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>periodically updates itself). Whatever you end up showing ultimately will</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>depend on the current time. So you start writing functions which compute</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>the present time:</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a><span class="in">//| output: false</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a><span class="in">currentTime = function() {</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a><span class="in">  return Date.now();</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a><span class="in">currentHours = function() {</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a><span class="in">  return (Date.now() / (3600 * 1000)) % 12;</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a><span class="in">currentMinutes = function() {</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a><span class="in">  return (Date.now() / (60 * 1000)) % 60;</span></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a><span class="in">currentSeconds = function() {</span></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a><span class="in">  return (Date.now() / 1000) % 60;</span></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>But <span class="in">`Date.now()`</span> is always changing, and so your plain Javascript code needs</span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>infrastructure to update the display constantly, otherwise that value</span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>is only computed once per call:</span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a><span class="in">staticTime = { </span></span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a><span class="in">  return { hours: currentHours(), minutes: currentMinutes(), seconds: currentSeconds() };</span></span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a><span class="in">htl.html`&lt;tt&gt;${fmt(currentHours())}:${fmt(currentMinutes())}:${fmt(currentSeconds())}&lt;/tt&gt;`</span></span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a>"This is fine," you say. After all, we have Javascript:</span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a><span class="in">ttEl = {</span></span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a><span class="in">  return document.createElement("tt");</span></span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb9-57"><a href="#cb9-57" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb9-58"><a href="#cb9-58" aria-hidden="true" tabindex="-1"></a><span class="in">//| output: false</span></span>
<span id="cb9-59"><a href="#cb9-59" aria-hidden="true" tabindex="-1"></a><span class="in">function updateEl() {</span></span>
<span id="cb9-60"><a href="#cb9-60" aria-hidden="true" tabindex="-1"></a><span class="in">  ttEl.innerText = `${fmt(currentHours())}:${fmt(currentMinutes())}:${fmt(currentSeconds())}`;</span></span>
<span id="cb9-61"><a href="#cb9-61" aria-hidden="true" tabindex="-1"></a><span class="in">  window.requestAnimationFrame(updateEl);</span></span>
<span id="cb9-62"><a href="#cb9-62" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb9-63"><a href="#cb9-63" aria-hidden="true" tabindex="-1"></a><span class="in">updateEl()</span></span>
<span id="cb9-64"><a href="#cb9-64" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb9-65"><a href="#cb9-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-66"><a href="#cb9-66" aria-hidden="true" tabindex="-1"></a>But what if your data only updates once a minute? What if you _don't</span>
<span id="cb9-67"><a href="#cb9-67" aria-hidden="true" tabindex="-1"></a>know_ how often your data updates?  Eventually code like this becomes</span>
<span id="cb9-68"><a href="#cb9-68" aria-hidden="true" tabindex="-1"></a>a delicate dance of signals and event handlers.  Things can get</span>
<span id="cb9-69"><a href="#cb9-69" aria-hidden="true" tabindex="-1"></a>quickly out of hand.</span>
<span id="cb9-70"><a href="#cb9-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-71"><a href="#cb9-71" aria-hidden="true" tabindex="-1"></a><span class="fu">## Enter reactive values</span></span>
<span id="cb9-72"><a href="#cb9-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-73"><a href="#cb9-73" aria-hidden="true" tabindex="-1"></a>OJS, on the other hand, lets you define "reactive" values: special values that can</span>
<span id="cb9-74"><a href="#cb9-74" aria-hidden="true" tabindex="-1"></a>change, _and notify downstream code about the change_. So, we can write this instead:</span>
<span id="cb9-75"><a href="#cb9-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-78"><a href="#cb9-78" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb9-79"><a href="#cb9-79" aria-hidden="true" tabindex="-1"></a><span class="in">// "now" is a predefined reactive value that returns the current</span></span>
<span id="cb9-80"><a href="#cb9-80" aria-hidden="true" tabindex="-1"></a><span class="in">// value of Date.now()</span></span>
<span id="cb9-81"><a href="#cb9-81" aria-hidden="true" tabindex="-1"></a><span class="in">reactiveTime = {</span></span>
<span id="cb9-82"><a href="#cb9-82" aria-hidden="true" tabindex="-1"></a><span class="in">  const hours = (now / (3600 * 1000)) % 12;</span></span>
<span id="cb9-83"><a href="#cb9-83" aria-hidden="true" tabindex="-1"></a><span class="in">  const minutes = (now / (60 * 1000)) % 60;</span></span>
<span id="cb9-84"><a href="#cb9-84" aria-hidden="true" tabindex="-1"></a><span class="in">  const seconds = (now / 1000) % 60;</span></span>
<span id="cb9-85"><a href="#cb9-85" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb9-86"><a href="#cb9-86" aria-hidden="true" tabindex="-1"></a><span class="in">  return { hours, minutes, seconds };</span></span>
<span id="cb9-87"><a href="#cb9-87" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb9-88"><a href="#cb9-88" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb9-89"><a href="#cb9-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-90"><a href="#cb9-90" aria-hidden="true" tabindex="-1"></a>Now the values automatically update themselves. In OJS, you can</span>
<span id="cb9-91"><a href="#cb9-91" aria-hidden="true" tabindex="-1"></a>write code that uses these as if they were regular Javascript</span>
<span id="cb9-92"><a href="#cb9-92" aria-hidden="true" tabindex="-1"></a>values. OJS notices you're using reactive values, and turns</span>
<span id="cb9-93"><a href="#cb9-93" aria-hidden="true" tabindex="-1"></a>your definition into a reactive value as well:</span>
<span id="cb9-94"><a href="#cb9-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-97"><a href="#cb9-97" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb9-98"><a href="#cb9-98" aria-hidden="true" tabindex="-1"></a><span class="in">timeString = htl.html`&lt;tt&gt;${fmt(reactiveTime.hours)}:${fmt(reactiveTime.minutes)}:${fmt(reactiveTime.seconds)}&lt;/tt&gt;`</span></span>
<span id="cb9-99"><a href="#cb9-99" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb9-100"><a href="#cb9-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-101"><a href="#cb9-101" aria-hidden="true" tabindex="-1"></a>But we wanted an analog clock. So let's make an analog clock, using</span>
<span id="cb9-102"><a href="#cb9-102" aria-hidden="true" tabindex="-1"></a>SVG.</span>
<span id="cb9-103"><a href="#cb9-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-106"><a href="#cb9-106" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb9-107"><a href="#cb9-107" aria-hidden="true" tabindex="-1"></a><span class="in">//| label: fig-1</span></span>
<span id="cb9-108"><a href="#cb9-108" aria-hidden="true" tabindex="-1"></a><span class="in">//| fig.cap: An SVG clock built with reactive values.[^1]</span></span>
<span id="cb9-109"><a href="#cb9-109" aria-hidden="true" tabindex="-1"></a><span class="in">clock = {</span></span>
<span id="cb9-110"><a href="#cb9-110" aria-hidden="true" tabindex="-1"></a><span class="in">   const { hours, minutes, seconds } = reactiveTime;</span></span>
<span id="cb9-111"><a href="#cb9-111" aria-hidden="true" tabindex="-1"></a><span class="in">   const result = svg`&lt;svg width=200 height=200&gt;&lt;/svg&gt;`;</span></span>
<span id="cb9-112"><a href="#cb9-112" aria-hidden="true" tabindex="-1"></a><span class="in">   const hourAngle = toClockAngle(hours / 12);</span></span>
<span id="cb9-113"><a href="#cb9-113" aria-hidden="true" tabindex="-1"></a><span class="in">   const minuteAngle = toClockAngle(minutes / 60);</span></span>
<span id="cb9-114"><a href="#cb9-114" aria-hidden="true" tabindex="-1"></a><span class="in">   const secondAngle = toClockAngle(seconds / 60);</span></span>
<span id="cb9-115"><a href="#cb9-115" aria-hidden="true" tabindex="-1"></a><span class="in">   const main = svg`&lt;g transform="translate(100, 100) scale(1, -1)"&gt;&lt;/g&gt;`;</span></span>
<span id="cb9-116"><a href="#cb9-116" aria-hidden="true" tabindex="-1"></a><span class="in">   </span></span>
<span id="cb9-117"><a href="#cb9-117" aria-hidden="true" tabindex="-1"></a><span class="in">   result.appendChild(main);</span></span>
<span id="cb9-118"><a href="#cb9-118" aria-hidden="true" tabindex="-1"></a><span class="in">   main.appendChild(svg`&lt;circle r=95 fill="#eee"&gt;&lt;/circle&gt;`);</span></span>
<span id="cb9-119"><a href="#cb9-119" aria-hidden="true" tabindex="-1"></a><span class="in">   main.appendChild(clockHand(secondAngle, "red", 1));</span></span>
<span id="cb9-120"><a href="#cb9-120" aria-hidden="true" tabindex="-1"></a><span class="in">   main.appendChild(clockHand(minuteAngle, "black", 1));</span></span>
<span id="cb9-121"><a href="#cb9-121" aria-hidden="true" tabindex="-1"></a><span class="in">   main.appendChild(clockHand(hourAngle, "black", 3));</span></span>
<span id="cb9-122"><a href="#cb9-122" aria-hidden="true" tabindex="-1"></a><span class="in">   return result;</span></span>
<span id="cb9-123"><a href="#cb9-123" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb9-124"><a href="#cb9-124" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb9-125"><a href="#cb9-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-126"><a href="#cb9-126" aria-hidden="true" tabindex="-1"></a>OJS makes sure your SVG definition is also reactive, since it</span>
<span id="cb9-127"><a href="#cb9-127" aria-hidden="true" tabindex="-1"></a>also uses reactive values.</span>
<span id="cb9-128"><a href="#cb9-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-129"><a href="#cb9-129" aria-hidden="true" tabindex="-1"></a><span class="fu">## Extras</span></span>
<span id="cb9-130"><a href="#cb9-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-133"><a href="#cb9-133" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb9-134"><a href="#cb9-134" aria-hidden="true" tabindex="-1"></a><span class="in">//| output: false</span></span>
<span id="cb9-135"><a href="#cb9-135" aria-hidden="true" tabindex="-1"></a><span class="in">function fmt(n)</span></span>
<span id="cb9-136"><a href="#cb9-136" aria-hidden="true" tabindex="-1"></a><span class="in">{</span></span>
<span id="cb9-137"><a href="#cb9-137" aria-hidden="true" tabindex="-1"></a><span class="in">   const s = ("00" + String(~~n));</span></span>
<span id="cb9-138"><a href="#cb9-138" aria-hidden="true" tabindex="-1"></a><span class="in">   return s.substr(s.length - 2);</span></span>
<span id="cb9-139"><a href="#cb9-139" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb9-140"><a href="#cb9-140" aria-hidden="true" tabindex="-1"></a><span class="in">function toClockAngle(v)</span></span>
<span id="cb9-141"><a href="#cb9-141" aria-hidden="true" tabindex="-1"></a><span class="in">{</span></span>
<span id="cb9-142"><a href="#cb9-142" aria-hidden="true" tabindex="-1"></a><span class="in">  // some math is needed here because unlike polar coordinates, </span></span>
<span id="cb9-143"><a href="#cb9-143" aria-hidden="true" tabindex="-1"></a><span class="in">  // clock hands run clockwise and start at the "north pole"</span></span>
<span id="cb9-144"><a href="#cb9-144" aria-hidden="true" tabindex="-1"></a><span class="in">  return -(-Math.PI / 2 + Math.PI * 2 * v) * (180 / Math.PI);</span></span>
<span id="cb9-145"><a href="#cb9-145" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb9-146"><a href="#cb9-146" aria-hidden="true" tabindex="-1"></a><span class="in">function clockHand(angle, color, width)</span></span>
<span id="cb9-147"><a href="#cb9-147" aria-hidden="true" tabindex="-1"></a><span class="in">{</span></span>
<span id="cb9-148"><a href="#cb9-148" aria-hidden="true" tabindex="-1"></a><span class="in">  return svg`&lt;line transform="rotate(${angle})" x1=0 y1=0 x2=90 y2=0 stroke=${color} stroke-width=${width}&gt;&lt;/line&gt;`</span></span>
<span id="cb9-149"><a href="#cb9-149" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb9-150"><a href="#cb9-150" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb9-151"><a href="#cb9-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-152"><a href="#cb9-152" aria-hidden="true" tabindex="-1"></a><span class="ot">[^1]: </span>Note that <span class="in">`now`</span> doesn't take timezones into account, so you're likely to see your clock a few hours off.</span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
<!-- -->
</section>
<section class="footnotes" role="doc-endnotes"><h2>Footnotes</h2>

<ol>
<li id="fn1" role="doc-endnote"><p>Note that <code>now</code> doesn’t take timezones into account, so you’re likely to see your clock a few hours off.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>
</main>
<div class="page-navigation page-navigation-docked">
  <div class="nav-page nav-page-previous">
  </div>
  <div class="nav-page nav-page-next">
  </div>
</div>
</div> <!-- /main column -->
</div> <!-- /row -->
</div> <!-- /container fluid -->
<script type="ojs-module-contents">
{"contents":[{"methodName":"interpret","cellName":"ojs-cell-1","inline":false,"source":"currentTime = function() {\n  return Date.now();\n}\ncurrentHours = function() {\n  return (Date.now() / (3600 * 1000)) % 12;\n}\ncurrentMinutes = function() {\n  return (Date.now() / (60 * 1000)) % 60;\n}\ncurrentSeconds = function() {\n  return (Date.now() / 1000) % 60;\n}"},{"methodName":"interpret","cellName":"ojs-cell-2","inline":false,"source":"staticTime = { \n  return { hours: currentHours(), minutes: currentMinutes(), seconds: currentSeconds() };\n}\nhtl.html`<tt>${fmt(currentHours())}:${fmt(currentMinutes())}:${fmt(currentSeconds())}</tt>`"},{"methodName":"interpret","cellName":"ojs-cell-3","inline":false,"source":"ttEl = {\n  return document.createElement(\"tt\");\n}"},{"methodName":"interpret","cellName":"ojs-cell-4","inline":false,"source":"function updateEl() {\n  ttEl.innerText = `${fmt(currentHours())}:${fmt(currentMinutes())}:${fmt(currentSeconds())}`;\n  window.requestAnimationFrame(updateEl);\n}\nupdateEl()"},{"methodName":"interpret","cellName":"ojs-cell-5","inline":false,"source":"// \"now\" is a predefined reactive value that returns the current\n// value of Date.now()\nreactiveTime = {\n  const hours = (now / (3600 * 1000)) % 12;\n  const minutes = (now / (60 * 1000)) % 60;\n  const seconds = (now / 1000) % 60;\n  \n  return { hours, minutes, seconds };\n}"},{"methodName":"interpret","cellName":"ojs-cell-6","inline":false,"source":"timeString = htl.html`<tt>${fmt(reactiveTime.hours)}:${fmt(reactiveTime.minutes)}:${fmt(reactiveTime.seconds)}</tt>`"},{"methodName":"interpret","cellName":"ojs-cell-7","inline":false,"source":"clock = {\n   const { hours, minutes, seconds } = reactiveTime;\n   const result = svg`<svg width=200 height=200></svg>`;\n   const hourAngle = toClockAngle(hours / 12);\n   const minuteAngle = toClockAngle(minutes / 60);\n   const secondAngle = toClockAngle(seconds / 60);\n   const main = svg`<g transform=\"translate(100, 100) scale(1, -1)\"></g>`;\n   \n   result.appendChild(main);\n   main.appendChild(svg`<circle r=95 fill=\"#eee\"></circle>`);\n   main.appendChild(clockHand(secondAngle, \"red\", 1));\n   main.appendChild(clockHand(minuteAngle, \"black\", 1));\n   main.appendChild(clockHand(hourAngle, \"black\", 3));\n   return result;\n}"},{"methodName":"interpret","cellName":"ojs-cell-8","inline":false,"source":"function fmt(n)\n{\n   const s = (\"00\" + String(~~n));\n   return s.substr(s.length - 2);\n}\nfunction toClockAngle(v)\n{\n  // some math is needed here because unlike polar coordinates, \n  // clock hands run clockwise and start at the \"north pole\"\n  return -(-Math.PI / 2 + Math.PI * 2 * v) * (180 / Math.PI);\n}\nfunction clockHand(angle, color, width)\n{\n  return svg`<line transform=\"rotate(${angle})\" x1=0 y1=0 x2=90 y2=0 stroke=${color} stroke-width=${width}></line>`\n}"}]}
</script>
<script type="module">
window._ojs.paths.runtimeToDoc = "../../features";
window._ojs.paths.runtimeToRoot = "../..";
window._ojs.paths.docToRoot = "..";
window._ojs.selfContained = false;
window._ojs.runtime.interpretFromScriptTags();
</script>


</body></html>